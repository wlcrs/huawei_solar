name: "Mark or close stale issues and PRs"
permissions:
  contents: read
  issues: write
  pull-requests: write
on:
  schedule:
  - cron: "0 0 * * *"

jobs:
  stale:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/stale@1160a2240286f5da8ec72b1c0816ce2481aabf84 # v8.0.0
      with:
        repo-token: ${{ secrets.GITHUB_TOKEN }}
        # Staling issues and PR's
        days-before-stale: 30
        stale-issue-label: stale
        stale-pr-label: stale
        stale-issue-message: |
          This issue has been automatically marked as stale because it has been open 30 days
          with no activity. Remove stale label or comment or this issue will be closed in 10 days
        stale-pr-message: |
          This PR has been automatically marked as stale because it has been open 30 days
          with no activity. Remove stale label or comment or this PR will be closed in 10 days
        # Not stale if have this labels or part of milestone
        exempt-issue-labels: wip,on-hold
        exempt-pr-labels:    wip,on-hold
        exempt-all-milestones: true
        # Close issue operations
        # Label will be automatically removed if the issues are no longer closed nor locked.
        days-before-close: 10
        delete-branch: true
        close-issue-message: This issue was automatically closed because of stale in 10 days
        close-pr-message: This PR was automatically closed because of stale in 10 days
    - name: "Manage 'incomplete' issues"
      uses: actions/stale@1160a2240286f5da8ec72b1c0816ce2481aabf84 # v8.0.0
      with:
        repo-token: ${{ secrets.GITHUB_TOKEN }}
        
        # Configuration for 'incomplete' issues
        days-before-stale: 4
        days-before-close: 3
        
        # KEY SETTING: Limit this step ONLY to issues with this label
        only-labels: incomplete
        
        # Reuse the existing stale label or use a unique one
        stale-issue-label: stale
        
        # Disable PR processing for this step (since you only mentioned Issues)
        days-before-pr-stale: -1
        days-before-pr-close: -1
        
        # Custom messages for this specific rule
        stale-issue-message: |
          This issue is marked 'incomplete' and has been inactive for 4 days. 
          Please provide the missing information or this will be closed in 3 days.
        close-issue-message: |
          This incomplete issue was closed due to lack of activity.
